# PowerMerger

A PowerShell tool for generating text files from templates and PowerShell objects. It's designed to automate the creation of reports, configuration files, HTML, and more.

- [Key Features](#key-features)
- [Installation](#installation)
- [Quick Start: Generate a single document](#quick-start-generate-a-single-document)
- [Core Concepts: How Templating Works](#core-concepts-how-templating-works)
- [Usage Examples](#usage-examples)
- [API at a Glance](#api-at-a-glance)
- [Extensibility](#extensibility)

## Key Features

- **Simple Templating:** Use plain text templates with placeholders like `%FieldName%`.
- **Dynamic Sections:** Define blocks in your template that repeat for each object in a collection.
- **Static Placeholders:** Set placeholders that are the same for the entire document.
- **Extensible Output Processors:** Control where the output goes (string, files, or your own custom logic).
- **Customizable Markers:** Change the default placeholder wrapper (`%`) and dynamic section name to fit your needs.
- **Progress Bar:** An optional progress bar shows the status when processing large datasets.

## Installation

Clone this repository and import the module directly:
```powershell
Import-Module -Name .\Path\To\PowerMerger.psm1
```

## Quick Start: Generate a single document

This example generates one Markdown report from a list of users.

**Template (`template.md`):**

```markdown
# User Report - %ReportDate%

---
%Dynamic%
## %Name%
- **ID:** %Id%
%Dynamic%
---
```

**PowerShell script:**

```powershell
$users = @(
    [pscustomobject]@{ Id = 101; Name = 'Alice' }
    [pscustomobject]@{ Id = 102; Name = 'Bob' }
)

$request = New-MergerRequest -TemplatePath ".\template.md" `
    -StaticFields @{ ReportDate = (Get-Date).ToString('yyyy-MM-dd') } `
    -Object $users

$processor = New-MergerOutStringProcessor
$result = $request | New-MergerBuild -Processor $processor
$result | Write-Host
```
**Expected Output:**

```markdown
# User Report - 2024-11-03

---
## Alice
- **ID:** 101
## Bob
- **ID:** 102
---
```

## Core Concepts: How Templating Works

PowerMerger processes templates by reading them line by line. This imposes one important rule:

**Rule:** The dynamic section marker (e.g., `%Dynamic%`) **must be on its own line**.

**Correct:**
```
A static field like %MyCompany%
%Dynamic%
A field to be repeated for each object, like %UserName%.
%Dynamic%
```
**Incorrect:**
```
A static field like %MyCompany%
%Dynamic% A field to be repeated for each object, like %UserName%. %Dynamic%
```

## Usage Examples

### Example 1: Generating One File Per Object

This example demonstrates how to create a separate file for each object and also uses a static field that will be the same across all generated files.

**Note:** The destination directory passed to the `-DestDir` parameter must exist.

**Template (`user-profile.html`):**

Notice how the entire HTML structure is enclosed between the two `%Dynamic%` lines. Static placeholders like `%SystemName%` will still work correctly inside this block.

```html
%Dynamic%
<!DOCTYPE html>
<html>
<head><title>User Profile: %Name%</title></head>
<body>
    <h1>%Name%</h1>
    <p>User ID: %UserID%</p>
    <footer>Generated by %SystemName%</footer>
</body>
</html>
%Dynamic%
```

**Powershell script:**

```powershell
$users = @(
    [pscustomobject]@{ UserID = 'u-001'; Name = 'Alice'; HtmlFileName = 'alice-profile' },
    [pscustomobject]@{ UserID = 'u-002'; Name = 'Bob';   HtmlFileName = 'bob-profile' }
)

$request = New-MergerRequest -TemplatePath ".\user-profile.html" `
    -StaticFields @{ SystemName = 'PowerMerger Reporting Engine' } `
    -Object $users

$processor = New-MergerOutFileProcessor -PropertyName 'HtmlFileName' -DestDir ".\output" -Extension ".html"

$request | New-MergerBuild -Processor $processor
```

This generates `alice-profile.html` and `bob-profile.html` in the `.\output` directory. Each file will contain the user-specific information and the same static footer text.

### Example 2: Advanced Customization

Use `-FieldWrapper` and `-DynamicContentField` to change the default markers if they conflict with your template's syntax. The wrapper is symmetrical.

**Template (`template.bat`):**

```batch
@echo off
REM This script uses a custom marker __VAR__ instead of %%VAR%%
echo User: __UserName__
```
**PowerShell script:**

```powershell
$request = New-MergerRequest -TemplatePath ".\template.bat" `
    -FieldWrapper "__" `
    -StaticFields @{ UserName = 'Admin' }

$processor = New-MergerOutStringProcessor
$result = $request | New-MergerBuild -Processor $processor
Write-Host $result
```

## API at a Glance

- `New-MergerRequest`: Creates the job request, defining the template, data, and settings.
- `New-Merger...Processor`: Creates a processor that defines the output destination (e.g., `New-MergerOutFileProcessor`).
- `New-MergerBuild`: The engine that executes the job.

## Extensibility

**PowerMerger** is designed to be extensible. You can create your own processor classes by inheriting from `MergerProcessor` to send output to different targets, like a database, a REST API, or a Zip archive.
